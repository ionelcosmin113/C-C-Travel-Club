package proiect.fis.CC.controller;

import java.io.FileReader;
import java.io.IOException;
import java.io.Reader;
import java.util.ArrayList;
import javafx.fxml.FXML;
import javafx.fxml.FXMLLoader;
import javafx.scene.Node;
import javafx.scene.control.ListView;
import javafx.scene.control.SelectionMode;
import javafx.scene.control.TextField;
import javafx.scene.layout.AnchorPane;
import javafx.scene.text.Text;
import org.json.simple.JSONArray;
import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;
import org.json.simple.parser.ParseException;
import proiect.fis.CC.services.ClientService;

public class RoomSelectionController {
    @FXML
    private TextField checkin;
    @FXML
    private TextField checkout;
    @FXML
    private Text message;
    @FXML
    private ListView<String> roomList;
    @FXML
    private AnchorPane RoomSelection;
    private String selection = "";
    private String checkinDate;
    private String checkoutDate;
    private static ArrayList list;
    private String username;
    private JSONObject user;
    private JSONParser parseruser = new JSONParser();

    public RoomSelectionController() {
    }

    public void initialize() {
        JSONObject obj;
        try {
            Reader reader1 = new FileReader("src/main/java/data/logininfo.json");
            Throwable var2 = null;

            try {
                obj = (JSONObject)this.parseruser.parse(reader1);
                this.user = obj;
                this.username = this.user.get("username").toString();
            } catch (Throwable var34) {
                var2 = var34;
                throw var34;
            } finally {
                if (reader1 != null) {
                    if (var2 != null) {
                        try {
                            reader1.close();
                        } catch (Throwable var33) {
                            var2.addSuppressed(var33);
                        }
                    } else {
                        reader1.close();
                    }
                }

            }
        } catch (IOException var39) {
            var39.printStackTrace();
        } catch (ParseException var40) {
            var40.printStackTrace();
        }

        JSONParser parser1 = new JSONParser();

        try {
            Reader reader = new FileReader("src/main/java/data/rooms.json");
            Throwable var43 = null;

            try {
                JSONArray jsonArray = (JSONArray)parser1.parse(reader);
                list = jsonArray;
            } catch (Throwable var32) {
                var43 = var32;
                throw var32;
            } finally {
                if (reader != null) {
                    if (var43 != null) {
                        try {
                            reader.close();
                        } catch (Throwable var31) {
                            var43.addSuppressed(var31);
                        }
                    } else {
                        reader.close();
                    }
                }

            }
        } catch (IOException var36) {
            var36.printStackTrace();
        } catch (ParseException var37) {
            var37.printStackTrace();
        }

        for(int i = 0; i < list.size(); ++i) {
            obj = (JSONObject)list.get(i);
            this.roomList.getItems().add(obj.get("Number").toString() + "  " + obj.get("Category").toString() + "  " + obj.get("Price").toString());
        }

        this.roomList.getSelectionModel().setSelectionMode(SelectionMode.SINGLE);
    }

    @FXML
    void Select() {
        if (this.roomList.getSelectionModel().getSelectedItem() == null) {
            this.message.setText("Please select a room and a checkin/checkout period");
        } else {
            this.selection = (String)this.roomList.getSelectionModel().getSelectedItem();
            this.checkinDate = this.checkin.getText();
            this.checkoutDate = this.checkout.getText();
            String s = HotelSelectionController.getHotelSelection();
            if (ClientService.writeRequest(this.selection, this.checkinDate, this.checkoutDate, this.username, s)) {
                this.message.setText("Request successful");
            } else {
                this.message.setText("Request failed");
            }
        }

    }

    @FXML
    void Back() {
        try {
            AnchorPane pane = (AnchorPane)FXMLLoader.load(this.getClass().getClassLoader().getResource("HotelSelection.fxml"));
            this.RoomSelection.getChildren().setAll(new Node[]{pane});
        } catch (Exception var2) {
        }

    }
}
